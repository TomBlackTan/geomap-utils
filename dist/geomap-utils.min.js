/*!
  * geomap-utils v0.1.0
  * (c) 2019 Esri China PS
  * @license MIT
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).GeomapUtils=r()}(this,function(){"use strict";function c(e){var r,t,n,o=(r=e,document.querySelector('link[href*="'+r+'"]'));return o||(t=e,(n=document.createElement("link")).rel="stylesheet",n.href=t,o=n,document.head.appendChild(o)),o}var u,e="undefined"!=typeof window,r="https://js.arcgis.com/4.10/";function s(e,r,t){var n,o,i,a;t&&(i=t,a=function(e){i(e.error||new Error("There was an error attempting to load "+o.src)),o.removeEventListener("error",a,!1)},(o=e).addEventListener("error",a,!1),n=a);var c=function(){r(e),e.removeEventListener("load",c,!1),n&&e.removeEventListener("error",n,!1)};e.addEventListener("load",c,!1)}var t={Promise:e?window.Promise:void 0};function l(){return document.querySelector("script[data-esri-loader]")}function f(){var e=window.require;return e&&e.on}function n(a){return void 0===a&&(a={}),a.url||(a.url=r),new t.Promise(function(e,r){var t,n,o=l();if(o){var i=o.getAttribute("src");i!==a.url?r(new Error("The ArcGIS API for JavaScript is already loaded ("+i+").")):f()?e(o):s(o,e,r)}else f()?r(new Error("The ArcGIS API for JavaScript is already loaded.")):(a.css&&c(a.css),a.dojoConfig&&(window.dojoConfig=a.dojoConfig),t=a.url,(n=document.createElement("script")).type="text/javascript",n.src=t,n.setAttribute("data-esri-loader","loading"),o=n,u=a.url,s(o,function(){o.setAttribute("data-esri-loader","loaded"),e(o)},r),document.body.appendChild(o))})}function o(r){return new t.Promise(function(t,e){var n=window.require.on("error",e);window.require(r,function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];n.remove(),t(e)})})}var i={getScript:l,isLoaded:f,loadModules:function(e,r){return void 0===r&&(r={}),f()?o(e):(!r.url&&u&&(r.url=u),n(r).then(function(){return o(e)}))},loadScript:n,loadCss:c,utils:t};var a,p={load:function(e){var r={};return window.dojoConfig&&(r.dojoConfig=window.dojoConfig),window.apiRoot&&(r.url=window.apiRoot),i.utils.Promise||(i.utils.Promise=window.Promise),i.loadModules(e,r)}};function d(e,r,t,n,o,i,a){try{var c=e[i](a),u=c.value}catch(e){return void t(e)}c.done?r(u):Promise.resolve(u).then(n,o)}function y(c){return function(){var e=this,a=arguments;return new Promise(function(r,t){var n=c.apply(e,a);function o(e){d(n,r,t,o,i,"next",e)}function i(e){d(n,r,t,o,i,"throw",e)}o(void 0)})}}function h(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=[],n=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(t.push(a.value),!r||t.length!==r);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return t}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(){return(v=y(regeneratorRuntime.mark(function e(r,t,n){var o,i,a,c,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.load(["esri/WebMap","esri/views/MapView"]);case 2:return o=e.sent,i=m(o,2),a=i[0],c=i[1],u=new a({portalItem:{id:t,portal:r}}),s=new c({container:n,map:u,ui:{components:[]}}),e.abrupt("return",s);case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function g(){return(g=y(regeneratorRuntime.mark(function e(r,t){var n,o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.load(["esri/WebMap"]);case 2:n=e.sent,o=m(n,1),i=o[0],(a=new i({portalItem:{id:t}})).load().then(function(){a.basemap.load().then(function(){r.map.basemap=a.basemap})});case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function w(e,r){return e.map.layers.find(function(e){return e.title===r})}var b={map2d:{initMapView:function(e,r,t){return v.apply(this,arguments)},getLayerByTitle:w,getLayerByIndex:function(e,r){return e.map.layers.getItemAt(r)},getLayerById:function(e,r){return e.map.findLayerById()},setLayerVisible:function(e,r,t){w(e,r).visible=t},highlightByLayerObjid:function(e,r,t){var n=w(e,r);e.whenLayerView(n).then(function(e){e.highlight(1*t)})},queryFeathersFromLayer:function(e,r){var t=e.createQuery();return t.where=r,e.queryFeatures(t)},highlightByLayerGraphic:function(e,r,t,n){var o=null;e.whenLayerView(r).then(function(e){o&&o.remove(),o=e.highlight(t)}),e.on("click",function(e){o&&o.remove()}),n&&e.goTo({target:t.geometry,tilt:70},{duration:2e3,easing:"in-out-expo"})},switchBaseMapByWebmapId:function(e,r){return g.apply(this,arguments)}},map3d:{gotoBySliderName:function(r,t){var e=r.map.presentation.slides.items,n={duration:3e3,maxDuration:3e3};e.forEach(function(e){e.title.text===t&&r.goTo(e.viewpoint,n)})},roamByLongtitude:function(r){a=a?(clearInterval(a),null):setInterval(function(){var e=r.camera.clone();e.position.longitude+=5,r.goTo(e)},100)}}},j={WrapCls:function(){function r(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),this.beforeOnLoad=e.before,this.afterUnload=e.after,this.layer=e.layer}var e,t,n,o,i,a,c;return e=r,(t=[{key:"beforeOnLoad",value:(c=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"afterUnload",value:(a=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"addToView",value:(i=y(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.beforeOnLoad();case 2:r.map.add(this.layer);case 3:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"removeFromView",value:(o=y(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.afterUnload();case 2:r.map.layers.remove(this.layer);case 3:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}])&&h(e.prototype,t),n&&h(e,n),r}()};var O,x,A=(function(e,r){var t;t=function(){function h(){for(var e=0,r={};e<arguments.length;e++){var t=arguments[e];for(var n in t)r[n]=t[n]}return r}return function e(d){function y(e,r,t){var n;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(t=h({path:"/"},y.defaults,t)).expires){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*t.expires),t.expires=o}t.expires=t.expires?t.expires.toUTCString():"";try{n=JSON.stringify(r),/^[\{\[]/.test(n)&&(r=n)}catch(e){}r=d.write?d.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var i="";for(var a in t)t[a]&&(i+="; "+a,!0!==t[a]&&(i+="="+t[a]));return document.cookie=e+"="+r+i}e||(n={});for(var c=document.cookie?document.cookie.split("; "):[],u=/(%[0-9A-Z]{2})+/g,s=0;s<c.length;s++){var l=c[s].split("="),f=l.slice(1).join("=");this.json||'"'!==f.charAt(0)||(f=f.slice(1,-1));try{var p=l[0].replace(u,decodeURIComponent);if(f=d.read?d.read(f,p):d(f,p)||f.replace(u,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(e===p){n=f;break}e||(n[p]=f)}catch(e){}}return n}}return(y.set=y).get=function(e){return y.call(y,e)},y.getJSON=function(){return y.apply({json:!0},[].slice.call(arguments))},y.defaults={},y.remove=function(e,r){y(e,"",h(r,{expires:-1}))},y.withConverter=e,y}(function(){})},e.exports=t()}(O={exports:{}},O.exports),O.exports),C=Object.prototype.hasOwnProperty,L=function(){for(var e=[],r=0;r<256;++r)e.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return e}(),k=function(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(t[n]=e[n]);return t},R={arrayToObject:k,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,r){return[].concat(e,r)},compact:function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],n=0;n<r.length;++n)for(var o=r[n],i=o.obj[o.prop],a=Object.keys(i),c=0;c<a.length;++c){var u=a[c],s=i[u];"object"==typeof s&&null!==s&&-1===t.indexOf(s)&&(r.push({obj:i,prop:u}),t.push(s))}return function(e){for(;1<e.length;){var r=e.pop(),t=r.obj[r.prop];if(Array.isArray(t)){for(var n=[],o=0;o<t.length;++o)void 0!==t[o]&&n.push(t[o]);r.obj[r.prop]=n}}}(r),e},decode:function(e,r,t){var n=e.replace(/\+/g," ");if("iso-8859-1"===t)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,r,t){if(0===e.length)return e;var n="string"==typeof e?e:String(e);if("iso-8859-1"===t)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var o="",i=0;i<n.length;++i){var a=n.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?o+=n.charAt(i):a<128?o+=L[a]:a<2048?o+=L[192|a>>6]+L[128|63&a]:a<55296||57344<=a?o+=L[224|a>>12]+L[128|a>>6&63]+L[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(i)),o+=L[240|a>>18]+L[128|a>>12&63]+L[128|a>>6&63]+L[128|63&a])}return o},isBuffer:function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function n(t,o,i){if(!o)return t;if("object"!=typeof o){if(Array.isArray(t))t.push(o);else{if("object"!=typeof t)return[t,o];(i&&(i.plainObjects||i.allowPrototypes)||!C.call(Object.prototype,o))&&(t[o]=!0)}return t}if("object"!=typeof t)return[t].concat(o);var e=t;return Array.isArray(t)&&!Array.isArray(o)&&(e=k(t,i)),Array.isArray(t)&&Array.isArray(o)?(o.forEach(function(e,r){C.call(t,r)?t[r]&&"object"==typeof t[r]?t[r]=n(t[r],e,i):t.push(e):t[r]=e}),t):Object.keys(o).reduce(function(e,r){var t=o[r];return C.call(e,r)?e[r]=n(e[r],t,i):e[r]=t,e},e)}},E=String.prototype.replace,P=/%20/g,S={default:"RFC3986",formatters:{RFC1738:function(e){return E.call(e,P,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},I={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},D=Array.isArray,N=Array.prototype.push,B=function(e,r){N.apply(e,D(r)?r:[r])},T=Date.prototype.toISOString,F={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:R.encode,encodeValuesOnly:!1,indices:!1,serializeDate:function(e){return T.call(e)},skipNulls:!1,strictNullHandling:!1},U=function e(r,t,n,o,i,a,c,u,s,l,f,p,d){var y=r;if("function"==typeof c?y=c(t,y):y instanceof Date&&(y=l(y)),null===y){if(o)return a&&!p?a(t,F.encoder,d):t;y=""}if("string"==typeof y||"number"==typeof y||"boolean"==typeof y||R.isBuffer(y))return a?[f(p?t:a(t,F.encoder,d))+"="+f(a(y,F.encoder,d))]:[f(t)+"="+f(String(y))];var h,m=[];if(void 0===y)return m;if(Array.isArray(c))h=c;else{var v=Object.keys(y);h=u?v.sort(u):v}for(var g=0;g<h.length;++g){var w=h[g];i&&null===y[w]||(Array.isArray(y)?B(m,e(y[w],n(t,w),n,o,i,a,c,u,s,l,f,p,d)):B(m,e(y[w],t+(s?"."+w:"["+w+"]"),n,o,i,a,c,u,s,l,f,p,d)))}return m},V=Object.prototype.hasOwnProperty,H={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,decoder:R.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},M=function(e,r,t){if(e){var n=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,c=[];if(a){if(!t.plainObjects&&V.call(Object.prototype,a)&&!t.allowPrototypes)return;c.push(a)}for(var u=0;null!==(i=o.exec(n))&&u<t.depth;){if(u+=1,!t.plainObjects&&V.call(Object.prototype,i[1].slice(1,-1))&&!t.allowPrototypes)return;c.push(i[1])}return i&&c.push("["+n.slice(i.index)+"]"),function(e,r,t){for(var n=r,o=e.length-1;0<=o;--o){var i,a=e[o];if("[]"===a&&t.parseArrays)i=[].concat(n);else{i=t.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(c,10);t.parseArrays||""!==c?!isNaN(u)&&a!==c&&String(u)===c&&0<=u&&t.parseArrays&&u<=t.arrayLimit?(i=[])[u]=n:i[c]=n:i={0:n}}n=i}return n}(c,r,t)}},q={jsapi:p,view:b,globals:{cookies:A,qs:{formats:S,parse:function(e,r){var t=r?R.assign({},r):{};if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(t.ignoreQueryPrefix=!0===t.ignoreQueryPrefix,t.delimiter="string"==typeof t.delimiter||R.isRegExp(t.delimiter)?t.delimiter:H.delimiter,t.depth="number"==typeof t.depth?t.depth:H.depth,t.arrayLimit="number"==typeof t.arrayLimit?t.arrayLimit:H.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.decoder="function"==typeof t.decoder?t.decoder:H.decoder,t.allowDots=void 0===t.allowDots?H.allowDots:!!t.allowDots,t.plainObjects="boolean"==typeof t.plainObjects?t.plainObjects:H.plainObjects,t.allowPrototypes="boolean"==typeof t.allowPrototypes?t.allowPrototypes:H.allowPrototypes,t.parameterLimit="number"==typeof t.parameterLimit?t.parameterLimit:H.parameterLimit,t.strictNullHandling="boolean"==typeof t.strictNullHandling?t.strictNullHandling:H.strictNullHandling,void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0===t.charset&&(t.charset=H.charset),""===e||null==e)return t.plainObjects?Object.create(null):{};for(var n="string"==typeof e?function(e,r){var t,n={},o=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=r.parameterLimit===1/0?void 0:r.parameterLimit,a=o.split(r.delimiter,i),c=-1,u=r.charset;if(r.charsetSentinel)for(t=0;t<a.length;++t)0===a[t].indexOf("utf8=")&&("utf8=%E2%9C%93"===a[t]?u="utf-8":"utf8=%26%2310003%3B"===a[t]&&(u="iso-8859-1"),c=t,t=a.length);for(t=0;t<a.length;++t)if(t!==c){var s,l,f=a[t],p=f.indexOf("]="),d=-1===p?f.indexOf("="):p+1;(l=-1===d?(s=r.decoder(f,H.decoder,u),r.strictNullHandling?null:""):(s=r.decoder(f.slice(0,d),H.decoder,u),r.decoder(f.slice(d+1),H.decoder,u)))&&r.interpretNumericEntities&&"iso-8859-1"===u&&(l=l.replace(/&#(\d+);/g,function(e,r){return String.fromCharCode(parseInt(r,10))})),V.call(n,s)?n[s]=R.combine(n[s],l):n[s]=l}return n}(e,t):e,o=t.plainObjects?Object.create(null):{},i=Object.keys(n),a=0;a<i.length;++a){var c=i[a],u=M(c,n[c],t);o=R.merge(o,u,t)}return R.compact(o)},stringify:function(e,r){var t=e,n=r?R.assign({},r):{};if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var o=void 0===n.delimiter?F.delimiter:n.delimiter,i="boolean"==typeof n.strictNullHandling?n.strictNullHandling:F.strictNullHandling,a="boolean"==typeof n.skipNulls?n.skipNulls:F.skipNulls,c="boolean"==typeof n.encode?n.encode:F.encode,u="function"==typeof n.encoder?n.encoder:F.encoder,s="function"==typeof n.sort?n.sort:null,l=void 0===n.allowDots?F.allowDots:!!n.allowDots,f="function"==typeof n.serializeDate?n.serializeDate:F.serializeDate,p="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:F.encodeValuesOnly,d=n.charset||F.charset;if(void 0!==n.charset&&"utf-8"!==n.charset&&"iso-8859-1"!==n.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0===n.format)n.format=S.default;else if(!Object.prototype.hasOwnProperty.call(S.formatters,n.format))throw new TypeError("Unknown format option provided.");var y,h,m=S.formatters[n.format];"function"==typeof n.filter?t=(h=n.filter)("",t):Array.isArray(n.filter)&&(y=h=n.filter);var v,g=[];if("object"!=typeof t||null===t)return"";v=n.arrayFormat in I?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var w=I[v];y||(y=Object.keys(t)),s&&y.sort(s);for(var b=0;b<y.length;++b){var j=y[b];a&&null===t[j]||B(g,U(t[j],j,w,i,a,c?u:null,h,s,l,f,m,p,d))}var O=g.join(o),x=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&(x+="iso-8859-1"===d?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),0<O.length?x+O:""}}},layer:j};return"undefined"!=typeof window&&(window.agsUtils=q),(x=Object.freeze({default:q}))&&x.default||x});