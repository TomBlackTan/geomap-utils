/*!
  * geomap-utils v0.1.0
  * (c) 2019 Esri China PS
  * @license MIT
  */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).GeomapUtils=r()}(this,function(){"use strict";function c(e){var r,t,o,n=(r=e,document.querySelector('link[href*="'+r+'"]'));return n||(t=e,(o=document.createElement("link")).rel="stylesheet",o.href=t,n=o,document.head.appendChild(n)),n}var l,e="undefined"!=typeof window,r="https://js.arcgis.com/4.10/";function s(e,r,t){var o,n,i,a;t&&(i=t,a=function(e){i(e.error||new Error("There was an error attempting to load "+n.src)),n.removeEventListener("error",a,!1)},(n=e).addEventListener("error",a,!1),o=a);var c=function(){r(e),e.removeEventListener("load",c,!1),o&&e.removeEventListener("error",o,!1)};e.addEventListener("load",c,!1)}var t={Promise:e?window.Promise:void 0};function u(){return document.querySelector("script[data-esri-loader]")}function f(){var e=window.require;return e&&e.on}function o(a){return void 0===a&&(a={}),a.url||(a.url=r),new t.Promise(function(e,r){var t,o,n=u();if(n){var i=n.getAttribute("src");i!==a.url?r(new Error("The ArcGIS API for JavaScript is already loaded ("+i+").")):f()?e(n):s(n,e,r)}else f()?r(new Error("The ArcGIS API for JavaScript is already loaded.")):(a.css&&c(a.css),a.dojoConfig&&(window.dojoConfig=a.dojoConfig),t=a.url,(o=document.createElement("script")).type="text/javascript",o.src=t,o.setAttribute("data-esri-loader","loading"),n=o,l=a.url,s(n,function(){n.setAttribute("data-esri-loader","loaded"),e(n)},r),document.body.appendChild(n))})}function n(r){return new t.Promise(function(t,e){var o=window.require.on("error",e);window.require(r,function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];o.remove(),t(e)})})}var i={getScript:u,isLoaded:f,loadModules:function(e,r){return void 0===r&&(r={}),f()?n(e):(!r.url&&l&&(r.url=l),o(r).then(function(){return n(e)}))},loadScript:o,loadCss:c,utils:t};var a={load:function(e){var r={};return window.dojoConfig&&(r.dojoConfig=window.dojoConfig),window.apiRoot&&(r.url=window.apiRoot),i.utils.Promise||(i.utils.Promise=window.Promise),i.loadModules(e,r)}};function d(e,r){return e.map.layers.find(function(e){return e.title===r})}var p={map2d:{getLayerByTitle:d,getLayerByIndex:function(e,r){return e.map.layers.getItemAt(r)},getLayerById:function(e,r){return e.map.findLayerById()},setLayerVisible:function(e,r,t){d(e,r).visible=t},highlightByLayerObjid:function(e,r,t){var o=d(e,r);e.whenLayerView(o).then(function(e){e.highlight(1*t)})},queryFeathersFromLayer:function(e,r){var t=e.createQuery();return t.where=r,e.queryFeatures(t)},highlightByLayerGraphic:function(e,r,t,o){var n=null;e.whenLayerView(r).then(function(e){n&&n.remove(),n=e.highlight(t)}),e.on("click",function(e){n&&n.remove()}),o&&e.goTo({target:t.geometry,tilt:70},{duration:2e3,easing:"in-out-expo"})}},map3d:{gotoBySliderName:function(r,t){var e=r.map.presentation.slides.items,o={duration:3e3,maxDuration:3e3};e.forEach(function(e){e.title.text===t&&r.goTo(e.viewpoint,o)})}}};var y,h,m=(function(e,r){var t;t=function(){function h(){for(var e=0,r={};e<arguments.length;e++){var t=arguments[e];for(var o in t)r[o]=t[o]}return r}return function e(p){function y(e,r,t){var o;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(t=h({path:"/"},y.defaults,t)).expires){var n=new Date;n.setMilliseconds(n.getMilliseconds()+864e5*t.expires),t.expires=n}t.expires=t.expires?t.expires.toUTCString():"";try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(e){}r=p.write?p.write(r,e):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var i="";for(var a in t)t[a]&&(i+="; "+a,!0!==t[a]&&(i+="="+t[a]));return document.cookie=e+"="+r+i}e||(o={});for(var c=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,s=0;s<c.length;s++){var u=c[s].split("="),f=u.slice(1).join("=");this.json||'"'!==f.charAt(0)||(f=f.slice(1,-1));try{var d=u[0].replace(l,decodeURIComponent);if(f=p.read?p.read(f,d):p(f,d)||f.replace(l,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch(e){}if(e===d){o=f;break}e||(o[d]=f)}catch(e){}}return o}}return(y.set=y).get=function(e){return y.call(y,e)},y.getJSON=function(){return y.apply({json:!0},[].slice.call(arguments))},y.defaults={},y.remove=function(e,r){y(e,"",h(r,{expires:-1}))},y.withConverter=e,y}(function(){})},e.exports=t()}(y={exports:{}},y.exports),y.exports),g=Object.prototype.hasOwnProperty,v=function(){for(var e=[],r=0;r<256;++r)e.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return e}(),w=function(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},o=0;o<e.length;++o)void 0!==e[o]&&(t[o]=e[o]);return t},x={arrayToObject:w,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,r){return[].concat(e,r)},compact:function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],o=0;o<r.length;++o)for(var n=r[o],i=n.obj[n.prop],a=Object.keys(i),c=0;c<a.length;++c){var l=a[c],s=i[l];"object"==typeof s&&null!==s&&-1===t.indexOf(s)&&(r.push({obj:i,prop:l}),t.push(s))}return function(e){for(;1<e.length;){var r=e.pop(),t=r.obj[r.prop];if(Array.isArray(t)){for(var o=[],n=0;n<t.length;++n)void 0!==t[n]&&o.push(t[n]);r.obj[r.prop]=o}}}(r),e},decode:function(e,r,t){var o=e.replace(/\+/g," ");if("iso-8859-1"===t)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(e){return o}},encode:function(e,r,t){if(0===e.length)return e;var o="string"==typeof e?e:String(e);if("iso-8859-1"===t)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var n="",i=0;i<o.length;++i){var a=o.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?n+=o.charAt(i):a<128?n+=v[a]:a<2048?n+=v[192|a>>6]+v[128|63&a]:a<55296||57344<=a?n+=v[224|a>>12]+v[128|a>>6&63]+v[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&o.charCodeAt(i)),n+=v[240|a>>18]+v[128|a>>12&63]+v[128|a>>6&63]+v[128|63&a])}return n},isBuffer:function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function o(t,n,i){if(!n)return t;if("object"!=typeof n){if(Array.isArray(t))t.push(n);else{if("object"!=typeof t)return[t,n];(i&&(i.plainObjects||i.allowPrototypes)||!g.call(Object.prototype,n))&&(t[n]=!0)}return t}if("object"!=typeof t)return[t].concat(n);var e=t;return Array.isArray(t)&&!Array.isArray(n)&&(e=w(t,i)),Array.isArray(t)&&Array.isArray(n)?(n.forEach(function(e,r){g.call(t,r)?t[r]&&"object"==typeof t[r]?t[r]=o(t[r],e,i):t.push(e):t[r]=e}),t):Object.keys(n).reduce(function(e,r){var t=n[r];return g.call(e,r)?e[r]=o(e[r],t,i):e[r]=t,e},e)}},b=String.prototype.replace,j=/%20/g,C={default:"RFC3986",formatters:{RFC1738:function(e){return b.call(e,j,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},L={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},O=Array.isArray,A=Array.prototype.push,E=function(e,r){A.apply(e,O(r)?r:[r])},S=Date.prototype.toISOString,P={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:x.encode,encodeValuesOnly:!1,indices:!1,serializeDate:function(e){return S.call(e)},skipNulls:!1,strictNullHandling:!1},D=function e(r,t,o,n,i,a,c,l,s,u,f,d,p){var y=r;if("function"==typeof c?y=c(t,y):y instanceof Date&&(y=u(y)),null===y){if(n)return a&&!d?a(t,P.encoder,p):t;y=""}if("string"==typeof y||"number"==typeof y||"boolean"==typeof y||x.isBuffer(y))return a?[f(d?t:a(t,P.encoder,p))+"="+f(a(y,P.encoder,p))]:[f(t)+"="+f(String(y))];var h,m=[];if(void 0===y)return m;if(Array.isArray(c))h=c;else{var g=Object.keys(y);h=l?g.sort(l):g}for(var v=0;v<h.length;++v){var w=h[v];i&&null===y[w]||(Array.isArray(y)?E(m,e(y[w],o(t,w),o,n,i,a,c,l,s,u,f,d,p)):E(m,e(y[w],t+(s?"."+w:"["+w+"]"),o,n,i,a,c,l,s,u,f,d,p)))}return m},N=Object.prototype.hasOwnProperty,k={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,decoder:x.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},I=function(e,r,t){if(e){var o=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,n=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(o),a=i?o.slice(0,i.index):o,c=[];if(a){if(!t.plainObjects&&N.call(Object.prototype,a)&&!t.allowPrototypes)return;c.push(a)}for(var l=0;null!==(i=n.exec(o))&&l<t.depth;){if(l+=1,!t.plainObjects&&N.call(Object.prototype,i[1].slice(1,-1))&&!t.allowPrototypes)return;c.push(i[1])}return i&&c.push("["+o.slice(i.index)+"]"),function(e,r,t){for(var o=r,n=e.length-1;0<=n;--n){var i,a=e[n];if("[]"===a&&t.parseArrays)i=[].concat(o);else{i=t.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(c,10);t.parseArrays||""!==c?!isNaN(l)&&a!==c&&String(l)===c&&0<=l&&t.parseArrays&&l<=t.arrayLimit?(i=[])[l]=o:i[c]=o:i={0:o}}o=i}return o}(c,r,t)}},R={jsapi:a,view:p,globals:{cookies:m,qs:{formats:C,parse:function(e,r){var t=r?x.assign({},r):{};if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(t.ignoreQueryPrefix=!0===t.ignoreQueryPrefix,t.delimiter="string"==typeof t.delimiter||x.isRegExp(t.delimiter)?t.delimiter:k.delimiter,t.depth="number"==typeof t.depth?t.depth:k.depth,t.arrayLimit="number"==typeof t.arrayLimit?t.arrayLimit:k.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.decoder="function"==typeof t.decoder?t.decoder:k.decoder,t.allowDots=void 0===t.allowDots?k.allowDots:!!t.allowDots,t.plainObjects="boolean"==typeof t.plainObjects?t.plainObjects:k.plainObjects,t.allowPrototypes="boolean"==typeof t.allowPrototypes?t.allowPrototypes:k.allowPrototypes,t.parameterLimit="number"==typeof t.parameterLimit?t.parameterLimit:k.parameterLimit,t.strictNullHandling="boolean"==typeof t.strictNullHandling?t.strictNullHandling:k.strictNullHandling,void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0===t.charset&&(t.charset=k.charset),""===e||null==e)return t.plainObjects?Object.create(null):{};for(var o="string"==typeof e?function(e,r){var t,o={},n=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=r.parameterLimit===1/0?void 0:r.parameterLimit,a=n.split(r.delimiter,i),c=-1,l=r.charset;if(r.charsetSentinel)for(t=0;t<a.length;++t)0===a[t].indexOf("utf8=")&&("utf8=%E2%9C%93"===a[t]?l="utf-8":"utf8=%26%2310003%3B"===a[t]&&(l="iso-8859-1"),c=t,t=a.length);for(t=0;t<a.length;++t)if(t!==c){var s,u,f=a[t],d=f.indexOf("]="),p=-1===d?f.indexOf("="):d+1;(u=-1===p?(s=r.decoder(f,k.decoder,l),r.strictNullHandling?null:""):(s=r.decoder(f.slice(0,p),k.decoder,l),r.decoder(f.slice(p+1),k.decoder,l)))&&r.interpretNumericEntities&&"iso-8859-1"===l&&(u=u.replace(/&#(\d+);/g,function(e,r){return String.fromCharCode(parseInt(r,10))})),N.call(o,s)?o[s]=x.combine(o[s],u):o[s]=u}return o}(e,t):e,n=t.plainObjects?Object.create(null):{},i=Object.keys(o),a=0;a<i.length;++a){var c=i[a],l=I(c,o[c],t);n=x.merge(n,l,t)}return x.compact(n)},stringify:function(e,r){var t=e,o=r?x.assign({},r):{};if(null!==o.encoder&&void 0!==o.encoder&&"function"!=typeof o.encoder)throw new TypeError("Encoder has to be a function.");var n=void 0===o.delimiter?P.delimiter:o.delimiter,i="boolean"==typeof o.strictNullHandling?o.strictNullHandling:P.strictNullHandling,a="boolean"==typeof o.skipNulls?o.skipNulls:P.skipNulls,c="boolean"==typeof o.encode?o.encode:P.encode,l="function"==typeof o.encoder?o.encoder:P.encoder,s="function"==typeof o.sort?o.sort:null,u=void 0===o.allowDots?P.allowDots:!!o.allowDots,f="function"==typeof o.serializeDate?o.serializeDate:P.serializeDate,d="boolean"==typeof o.encodeValuesOnly?o.encodeValuesOnly:P.encodeValuesOnly,p=o.charset||P.charset;if(void 0!==o.charset&&"utf-8"!==o.charset&&"iso-8859-1"!==o.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0===o.format)o.format=C.default;else if(!Object.prototype.hasOwnProperty.call(C.formatters,o.format))throw new TypeError("Unknown format option provided.");var y,h,m=C.formatters[o.format];"function"==typeof o.filter?t=(h=o.filter)("",t):Array.isArray(o.filter)&&(y=h=o.filter);var g,v=[];if("object"!=typeof t||null===t)return"";g=o.arrayFormat in L?o.arrayFormat:"indices"in o?o.indices?"indices":"repeat":"indices";var w=L[g];y||(y=Object.keys(t)),s&&y.sort(s);for(var b=0;b<y.length;++b){var j=y[b];a&&null===t[j]||E(v,D(t[j],j,w,i,a,c?l:null,h,s,u,f,m,d,p))}var O=v.join(n),A=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&(A+="iso-8859-1"===p?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),0<O.length?A+O:""}}}};return"undefined"!=typeof window&&(window.agsUtils=R),(h=Object.freeze({default:R}))&&h.default||h});